import{j as e}from"./ui-vendor-yLFRes2f.js";import{u as pe,r as i}from"./react-vendor-DWSrZqKN.js";import{k as re,a as je,bg as ve,c as l,b as d,P as fe,U as q,a3 as be,a4 as Ne,a5 as we,aA as F,aC as M,aq as ye,ar as Ce,as as ke,bh as Te,at as Se,au as Ie,Y as Q,$ as G,Q as J,a0 as K,a1 as W,a2 as X,ae as Z,aS as m,N as C,aa as ee,a8 as Ae,aB as se,aw as x,al as De,am as Ee,an as $e,ao as ae,bi as te,M as Fe,a$ as Me,v as Pe}from"./index-CqPKG3Vx.js";import{a as k,m as g}from"./utils-vendor-DFcOAB1P.js";import{S as Re}from"./send-DqZpEybG.js";import{P as Ue}from"./pen-line-3DgLAQwF.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=re("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=re("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);function Ge(){const{user:ze}=je(),{t:Be}=ve(),P=pe(),[T,ie]=i.useState([]),[r,R]=i.useState(null),[ne,U]=i.useState(!0),[le,p]=i.useState(!1),[oe,S]=i.useState(!1),[o,j]=i.useState(""),[v,f]=i.useState("editor"),[b,N]=i.useState(""),[w,y]=i.useState(!1),[ce,L]=i.useState(""),[h,_]=i.useState(""),[z,B]=i.useState(""),[O,de]=i.useState(""),me={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},I={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};i.useEffect(()=>{A()},[]);const A=async()=>{var s;try{U(!0);const a=localStorage.getItem("auth-method"),t=a?localStorage.getItem(`${a}-login-token`):null;if(!t){console.error("No authentication token found"),l.error("Authentication error. Please log in again."),setTimeout(()=>{P("/login",{replace:!0})},1500);return}const c=(await k.get("http://localhost:5000/api/teams",{headers:{Authorization:`Bearer ${t}`}})).data.data||[];ie(c),c.length>0&&(R(c[0]),L(c[0]._id))}catch(a){console.error("Failed to fetch teams:",a),((s=a.response)==null?void 0:s.status)===401?(l.error("Your session has expired. Please log in again."),setTimeout(()=>{P("/login",{replace:!0})},1500)):l.error("Failed to load teams. Please try again later.")}finally{U(!1)}},V=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),xe=async()=>{var s,a,t;if(!o.trim()){N("Please enter an email address");return}if(!V(o)){N("Please enter a valid email address");return}if(!r){l.error("No team selected");return}y(!0);try{const n=localStorage.getItem("token");if(!n){l.error("Authentication error. Please login again.");return}const D="http://localhost:5000/api",c=[{email:o,role:v}],$=(await k.post(`${D}/teams/${r._id}/invitations`,{invitations:c},{headers:{Authorization:`Bearer ${n}`}})).data.data.invitationResults;if($.filter(u=>u.success).length>0)l.success(`Invitation sent to ${o}`),j(""),f("editor"),S(!1),A();else{const u=((s=$[0])==null?void 0:s.message)||"Failed to send invitation";l.error(u)}}catch(n){console.error("Failed to send invitation:",n),l.error(((t=(a=n.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to send invitation")}finally{y(!1)}},H=s=>{switch(s){case"admin":return e.jsxs(x,{variant:"outline",className:"bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 border-blue-200 dark:border-blue-700",children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),"Admin"]});case"editor":return e.jsxs(x,{variant:"outline",className:"bg-green-50 text-green-700 dark:bg-green-900/30 dark:text-green-400 border-green-200 dark:border-green-700",children:[e.jsx(Ue,{className:"h-3 w-3 mr-1"}),"Editor"]});case"viewer":return e.jsxs(x,{variant:"outline",className:"bg-gray-50 text-gray-700 dark:bg-gray-800 dark:text-gray-400 border-gray-200 dark:border-gray-700",children:[e.jsx(Me,{className:"h-3 w-3 mr-1"}),"Viewer"]});default:return e.jsx(x,{variant:"outline",className:"bg-gray-50 text-gray-700 dark:bg-gray-800 dark:text-gray-400 border-gray-200 dark:border-gray-700",children:s})}},Y=(s,a,t)=>{var n;return s&&a?`${s[0]}${a[0]}`.toUpperCase():((n=t==null?void 0:t[0])==null?void 0:n.toUpperCase())||"U"},he=s=>{const a=T.find(t=>t._id===s);a&&(R(a),L(s))},ue=async()=>{var s,a;if(!h.trim()){de("Please enter a team name");return}y(!0);try{const t=localStorage.getItem("token");if(!t){l.error("Authentication error. Please login again.");return}const n="http://localhost:5000/api",c=(await k.post(`${n}/teams`,{name:h,description:z||`Team workspace for ${h}`},{headers:{Authorization:`Bearer ${t}`}})).data.data;if(l.success(`Team "${h}" created successfully`),o&&V(o))try{(await k.post(`${n}/teams/${c._id}/invitations`,{invitations:[{email:o,role:v}]},{headers:{Authorization:`Bearer ${t}`}})).data.data.invitationResults.filter(u=>u.success).length>0&&l.success(`Invitation sent to ${o}`)}catch(E){console.error("Failed to send invitation:",E)}_(""),B(""),j(""),f("editor"),p(!1),await A()}catch(t){console.error("Failed to create team:",t),l.error(((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to create team")}finally{y(!1)}};return ne?e.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-64px)]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Team Management"}),e.jsxs(d,{onClick:()=>p(!0),className:"bg-primary-600 hover:bg-primary-700 text-white",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Create Team"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsxs("div",{className:"w-full md:w-64",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(q,{className:"h-5 w-5 mr-2 text-primary"}),"Teams"]})}),e.jsx(be,{orientation:"vertical",value:ce,className:"w-full",onValueChange:he,children:e.jsx(Ne,{className:"flex flex-col h-auto bg-muted/50 p-1 rounded-md",children:T.length===0?e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"No teams found. Create your first team to get started."}):T.map(s=>e.jsxs(we,{value:s._id,className:"justify-start gap-2 p-2 h-auto",children:[e.jsx(F,{className:"h-6 w-6",children:e.jsx(M,{children:s.name[0]})}),e.jsx("span",{className:"truncate",children:s.name})]},s._id))})})]}),e.jsx("div",{className:"flex-1",children:r?e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:e.jsxs(ye,{children:[e.jsxs(Ce,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ke,{className:"text-2xl",children:r.name}),e.jsxs(d,{variant:"outline",size:"sm",children:[e.jsx(Te,{className:"h-4 w-4 mr-1"}),"Settings"]})]}),e.jsx(Se,{children:r.description||"No description provided"})]}),e.jsx(Ie,{children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Team Members"}),e.jsxs(Q,{open:oe,onOpenChange:S,children:[e.jsx(G,{asChild:!0,children:e.jsxs(d,{variant:"default",size:"sm",children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Invite Member"]})}),e.jsxs(K,{className:"sm:max-w-[425px]",children:[e.jsxs(W,{children:[e.jsx(X,{children:"Invite team member"}),e.jsx(Z,{children:"Send an invitation email to add a new member to this team."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"invite-email",className:"text-right",children:"Email"}),e.jsx(C,{id:"invite-email",value:o,onChange:s=>{j(s.target.value),N("")},placeholder:"colleague@example.com",className:"col-span-3"}),b&&e.jsx("div",{className:"col-span-4 text-right text-red-500 text-sm",children:b})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"invite-role",className:"text-right",children:"Role"}),e.jsxs("select",{id:"invite-role",value:v,onChange:s=>f(s.target.value),className:"col-span-3 flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"viewer",children:"Viewer"})]})]})]}),e.jsxs(ee,{children:[e.jsx(d,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(d,{onClick:xe,disabled:w,children:w?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin mr-2 h-4 w-4 border-t-2 border-b-2 border-white rounded-full"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4 mr-1"}),"Send Invitation"]})})]})]})]})]}),e.jsx(Ae,{className:"h-[300px]",children:e.jsxs(g.div,{variants:me,initial:"hidden",animate:"visible",className:"space-y-2",children:[e.jsxs(g.div,{variants:I,className:"flex items-center justify-between p-3 bg-primary/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(F,{children:[e.jsx(se,{src:r.owner.profileImage}),e.jsx(M,{children:Y(r.owner.firstName,r.owner.lastName,r.owner.email)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[r.owner.firstName," ",r.owner.lastName]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:r.owner.email})]})]}),e.jsxs(x,{variant:"secondary",className:"ml-auto mr-2",children:[e.jsx(Le,{className:"h-3 w-3 mr-1 text-amber-500"}),"Owner"]})]}),r.members.filter(s=>s.user._id!==r.owner._id).map(s=>e.jsxs(g.div,{variants:I,className:"flex items-center justify-between p-3 bg-background border border-border rounded-lg hover:bg-accent/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(F,{children:[e.jsx(se,{src:s.user.profileImage}),e.jsx(M,{children:Y(s.user.firstName,s.user.lastName,s.user.email)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.user.firstName," ",s.user.lastName]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.user.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[H(s.role),e.jsxs(De,{children:[e.jsx(Ee,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(_e,{className:"h-4 w-4"})})}),e.jsxs($e,{align:"end",children:[e.jsx(ae,{children:"Change Role"}),e.jsx(ae,{className:"text-red-500",children:"Remove Member"})]})]})]})]},s.user._id)),e.jsxs("div",{className:"pt-2",children:[e.jsx(te,{}),e.jsx("h4",{className:"text-sm font-medium mt-4 mb-2",children:"Pending Invitations"})]}),r.invitations&&r.invitations.length>0?r.invitations.filter(s=>s.status==="pending").map(s=>e.jsxs(g.div,{variants:I,className:"flex items-center justify-between p-3 bg-muted/30 border border-border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center",children:e.jsx(Fe,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.email}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Invited ",new Date(s.createdAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[H(s.role),e.jsx(x,{variant:"outline",className:"bg-yellow-50 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400 border-yellow-200 dark:border-yellow-700",children:"Pending"})]})]},s._id)):e.jsx("div",{className:"text-center py-4 text-muted-foreground text-sm",children:"No pending invitations"})]})})]})})})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-[400px] border border-dashed rounded-lg",children:[e.jsx(q,{className:"h-10 w-10 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No team selected"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Select a team from the list or create a new one"})]})})]}),e.jsxs(Q,{open:le,onOpenChange:p,children:[e.jsx(G,{asChild:!0,children:e.jsx("span",{className:"hidden",children:"New Team"})}),e.jsxs(K,{className:"sm:max-w-[425px]",children:[e.jsxs(W,{children:[e.jsx(X,{children:"Create a new team"}),e.jsx(Z,{children:"Create a new team and optionally invite your first team member."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"team-name",className:"text-right",children:"Team Name"}),e.jsx(C,{id:"team-name",value:h,onChange:s=>_(s.target.value),placeholder:"My awesome team",className:"col-span-3"}),O&&e.jsx("div",{className:"col-span-4 text-right text-red-500 text-sm",children:O})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"description",className:"text-right",children:"Description"}),e.jsx(C,{id:"description",value:z,onChange:s=>B(s.target.value),placeholder:"Team description (optional)",className:"col-span-3"})]}),e.jsx(te,{className:"my-2"}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"new-team-email",className:"text-right",children:"Invite Email"}),e.jsx(C,{id:"new-team-email",value:o,onChange:s=>{j(s.target.value),N("")},placeholder:"colleague@example.com (optional)",className:"col-span-3"}),b&&e.jsx("div",{className:"col-span-4 text-right text-red-500 text-sm",children:b})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"new-team-role",className:"text-right",children:"Role"}),e.jsxs("select",{id:"new-team-role",value:v,onChange:s=>f(s.target.value),className:"col-span-3 flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"viewer",children:"Viewer"})]})]})]}),e.jsxs(ee,{children:[e.jsx(d,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(d,{onClick:ue,disabled:w,children:w?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin mr-2 h-4 w-4 border-t-2 border-b-2 border-white rounded-full"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Create Team"]})})]})]})]})]})}export{Ge as default};
