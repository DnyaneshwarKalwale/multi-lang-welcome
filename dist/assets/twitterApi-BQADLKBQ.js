import{j as e}from"./ui-vendor-yLFRes2f.js";import{r as v}from"./react-vendor-DWSrZqKN.js";import{k as q,aA as L,aB as A,aC as k,s as B,l as C,m as z,aV as R,R as U}from"./index-CisuWjtJ.js";import{H as O}from"./heart-5GAuxEi9.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=q("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]),W=({media:s})=>!s||s.length===0?null:s.length>1?e.jsx("div",{className:`grid gap-2 mt-4 rounded-xl overflow-hidden ${s.length===2||s.length===3,"grid-cols-2"}`,children:s.map((d,y)=>e.jsx("div",{className:`${s.length===3&&y===0?"row-span-2":s.length===4&&y<2?"col-span-1":""} overflow-hidden relative`,children:e.jsx(I,{media:d})},d.media_key))}):e.jsx("div",{className:"mt-4 rounded-xl overflow-hidden relative",children:e.jsx(I,{media:s[0]})}),I=({media:s})=>{var g;const[d,y]=v.useState(!1),[x,_]=v.useState(!1),m=v.useRef(null);v.useEffect(()=>{s.type==="photo"&&m.current&&m.current.complete&&y(!0)},[s.type]);const r=()=>{y(!0)},u=()=>{_(!0),console.error(`Failed to load media: ${s.url}`)},c=((g=s.url)==null?void 0:g.includes("profile_images"))?"profile-media-container":"media-container";return s.type==="video"||s.type==="animated_gif"?e.jsxs("div",{className:"media-container relative",children:[!d&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse flex items-center justify-center",children:e.jsx("span",{className:"text-sm text-gray-600",children:"Loading video..."})}),e.jsx("video",{ref:m,src:s.url,poster:s.preview_image_url,controls:s.type==="video",autoPlay:s.type==="animated_gif",loop:s.type==="animated_gif",muted:s.type==="animated_gif",playsInline:!0,className:"w-full h-auto object-contain",onLoadedData:r,onError:u}),x&&e.jsx("div",{className:"absolute inset-0 bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-sm text-gray-500",children:"Video unavailable"})})]}):e.jsxs("div",{className:c+" relative",children:[e.jsx("img",{ref:m,src:s.url,alt:s.alt_text||"Tweet media",loading:"lazy",className:`w-full transition-opacity duration-500 ${d?"opacity-100":"opacity-0"}`,onLoad:r,onError:u}),!d&&!x&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse"}),x&&e.jsx("div",{className:"absolute inset-0 bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-sm text-gray-500",children:"Image unavailable"})})]})},K=({tweet:s})=>{var a,o,T,w,$,N;const[d,y]=v.useState(!1),[x,_]=v.useState(null),[m,r]=v.useState(!1);v.useEffect(()=>{if(!(d||x)&&!s.savedAt&&s.full_text&&s.full_text.length>s.text.length+20){_({...s,full_text:s.full_text});return}},[s,d,x]);const u=h=>{try{const t=new Date(h),n=(new Date().getTime()-t.getTime())/(1e3*60*60);return n<1?`${Math.floor(n*60)}m`:n<24?`${Math.floor(n)}h`:`${Math.floor(n/24)}d`}catch{return h}},f=h=>{if(!h)return!1;if(h.endsWith("…")||h.endsWith("...")||h.includes("… https://")||h.includes("... https://"))return!0;const l=/[\u0900-\u097F\u0600-\u06FF\u0590-\u05FF\u3040-\u30FF\u3400-\u4DBF\u4E00-\u9FFF]/.test(h)?180:240;return h.length>=l},c=v.useMemo(()=>{const h=(x==null?void 0:x.full_text)||s.full_text||s.text||"";return f(h)||s.is_long===!0},[s,x]),g=async()=>{var h;if(m){r(!1);return}if(r(!0),s.full_text||s.text,s.full_text&&s.full_text.length>(((h=s.text)==null?void 0:h.length)||0)+10){console.log(`Using tweet's full_text property for ${s.id}`),_({...s,full_text:s.full_text});return}if(s.savedAt){console.log(`Showing saved tweet content for ${s.id}`);return}console.log(`Tweet ${s.id} expanded - showing available content`)},b=h=>{const t=x;let l="";t!=null&&t.full_text?l=t.full_text:h.full_text?l=h.full_text:l=h.text;let n=l;if(n=n.replace(/\s*(https:\/\/t\.co\/\w{10,})\s*$/g,""),/https?:\/\/(?:bit\.ly|tinyurl|goo\.gl|t\.co)\/\w+/.test(n)||(n=n.replace(/(\s*[…\.]{3,})$/g,"")),m)return n;if(c||n.length>240){const i=Math.min(220,n.length/2);let p=n.substring(0,i);const j=/https?:\/\/[^\s]+/g,F=n.match(j)||[];for(const D of F){const S=n.indexOf(D);S<i&&S+D.length>i&&(S+D.length<i+30?p=n.substring(0,S+D.length):p=n.substring(0,S))}const M=p.lastIndexOf(" ");return M>i*.8&&(p=p.substring(0,M)),p+"..."}return n};return e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden w-full",children:e.jsx("div",{className:"px-3 py-3 h-full flex flex-col",children:e.jsxs("div",{className:"flex space-x-3 flex-1",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs(L,{className:"h-10 w-10",children:[e.jsx(A,{src:(a=s.author)==null?void 0:a.profile_image_url,alt:(o=s.author)==null?void 0:o.name,className:"object-cover"}),e.jsx(k,{className:"bg-gray-200 text-gray-600 text-sm font-medium",children:((w=(T=s.author)==null?void 0:T.name)==null?void 0:w.charAt(0))||"U"})]})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center space-x-1 min-w-0 text-sm",children:[e.jsx("span",{className:"font-bold text-gray-900 truncate",children:($=s.author)==null?void 0:$.name}),e.jsxs("span",{className:"text-gray-500 text-xs",children:["@",(N=s.author)==null?void 0:N.username]}),e.jsx("span",{className:"text-gray-400 text-xs",children:"·"}),e.jsx("span",{className:"text-gray-500 text-xs",children:u(s.created_at)}),s.savedAt&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400 text-xs",children:"·"}),e.jsx("span",{className:"text-green-600 text-xs bg-green-50 px-1.5 py-0.5 rounded-full font-medium",children:"Saved"})]})]})}),e.jsx("div",{className:"mb-3 flex-1",children:e.jsx("div",{className:"text-gray-900 text-sm leading-5 whitespace-pre-wrap break-words",children:d?e.jsxs("div",{className:"flex items-center text-gray-500 text-xs",children:[e.jsx(B,{className:"animate-spin h-3 w-3 mr-2"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[b(s),(c||s.text.length>240)&&e.jsx("button",{onClick:g,className:"mt-2 text-blue-500 hover:text-blue-600 text-xs font-normal inline-flex items-center space-x-1 transition-colors",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"animate-spin h-3 w-3"}),e.jsx("span",{children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:m?"Show less":"Show more"}),m?e.jsx(C,{className:"h-3 w-3"}):e.jsx(z,{className:"h-3 w-3"})]})})]})})}),s.media&&s.media.length>0&&e.jsx("div",{className:"mb-3 rounded-xl overflow-hidden border border-gray-200",children:e.jsx(W,{media:s.media})}),e.jsxs("div",{className:"flex items-center justify-between max-w-xs mt-auto",children:[e.jsxs("button",{className:"flex items-center space-x-1 text-gray-400 hover:text-blue-500 hover:bg-blue-50 px-2 py-1 rounded-full transition-colors group text-xs",children:[e.jsx(R,{className:"h-3 w-3 group-hover:text-blue-500"}),e.jsx("span",{className:"group-hover:text-blue-500",children:s.reply_count||0})]}),e.jsxs("button",{className:"flex items-center space-x-1 text-gray-400 hover:text-green-500 hover:bg-green-50 px-2 py-1 rounded-full transition-colors group text-xs",children:[e.jsx(U,{className:"h-3 w-3 group-hover:text-green-500"}),e.jsx("span",{className:"group-hover:text-green-500",children:s.retweet_count||0})]}),e.jsxs("button",{className:"flex items-center space-x-1 text-gray-400 hover:text-red-500 hover:bg-red-50 px-2 py-1 rounded-full transition-colors group text-xs",children:[e.jsx(O,{className:"h-3 w-3 group-hover:text-red-500"}),e.jsx("span",{className:"group-hover:text-red-500",children:s.favorite_count||0})]}),e.jsxs("button",{className:"flex items-center space-x-1 text-gray-400 hover:text-blue-500 hover:bg-blue-50 px-2 py-1 rounded-full transition-colors group text-xs",children:[e.jsx(H,{className:"h-3 w-3 group-hover:text-blue-500"}),e.jsx("span",{className:"group-hover:text-blue-500",children:s.quote_count||0})]})]})]})]})})})},Q=({thread:s})=>{var h;const[d,y]=v.useState(!0),[x,_]=v.useState(s.tweets),[m,r]=v.useState(new Set),[u,f]=v.useState(new Set),[c,g]=v.useState(new Map);if(!s||!s.tweets||s.tweets.length===0)return console.error("Thread is empty or missing tweets array"),null;v.useEffect(()=>{s.tweets.some(t=>t.savedAt)||s.tweets.forEach(t=>{t.full_text&&t.full_text.length>t.text.length+20&&(g(l=>new Map(l).set(t.id,t)),m.has(t.id)||r(l=>new Set(l).add(t.id)))})},[s.tweets]);const b=t=>{try{const l=new Date(t),i=(new Date().getTime()-l.getTime())/(1e3*60*60);return i<1?`${Math.floor(i*60)}m`:i<24?`${Math.floor(i)}h`:`${Math.floor(i/24)}d`}catch{return t}},a=s.tweets[0],o=s.author||a.author,T=t=>{if(!t)return!1;if(t.endsWith("…")||t.endsWith("...")||t.includes("… https://")||t.includes("... https://"))return!0;const n=/[\u0900-\u097F\u0600-\u06FF\u0590-\u05FF\u3040-\u30FF\u3400-\u4DBF\u4E00-\u9FFF]/.test(t)?180:240;return t.length>=n},w=t=>{const l=t.full_text||t.text||"";return T(l)||t.is_long===!0},$=async t=>{var j;const l=s.tweets.find(F=>F.id===t);if(!l){console.error(`Tweet with ID ${t} not found in thread`);return}const n=new Set(m);if(m.has(t)){n.delete(t),r(n);return}n.add(t),r(n);const i=c.get(t),p=l.full_text||l.text||"";if(i&&i.full_text&&i.full_text.length>p.length+20){console.log(`Using existing full tweet content for ${t}`);return}if(l.full_text&&l.full_text.length>(((j=l.text)==null?void 0:j.length)||0)+10){console.log(`Using tweet's full_text property for ${t}`),g(F=>new Map(F).set(t,{...l,full_text:l.full_text}));return}if(l.savedAt){console.log(`Showing saved tweet content for ${t}`);return}console.log(`Tweet ${t} expanded - showing available content`)},N=t=>{const l=c.get(t.id);let n="";l!=null&&l.full_text?n=l.full_text:t.full_text?n=t.full_text:n=t.text;let i=n;if(i=i.replace(/\s*(https:\/\/t\.co\/\w{10,})\s*$/g,""),/https?:\/\/(?:bit\.ly|tinyurl|goo\.gl|t\.co)\/\w+/.test(i)||(i=i.replace(/(\s*[…\.]{3,})$/g,"")),m.has(t.id))return i;if(w(t)||i.length>240){const p=Math.min(220,i.length/2);let j=i.substring(0,p);const F=/https?:\/\/[^\s]+/g,M=i.match(F)||[];for(const S of M){const E=i.indexOf(S);E<p&&E+S.length>p&&(E+S.length<p+30?j=i.substring(0,E+S.length):j=i.substring(0,E))}const D=j.lastIndexOf(" ");return D>p*.8&&(j=j.substring(0,D)),j+"..."}return i};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100 bg-gray-50/50",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(L,{className:"h-8 w-8",children:[e.jsx(A,{src:o==null?void 0:o.profile_image_url,alt:(o==null?void 0:o.name)||"Thread author",className:"object-cover"}),e.jsx(k,{className:"bg-gray-200 text-gray-600 text-xs font-medium",children:((h=o==null?void 0:o.name)==null?void 0:h.charAt(0))||"T"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-1 text-sm",children:[e.jsx("h3",{className:"font-bold text-gray-900 truncate",children:(o==null?void 0:o.name)||"Thread Author"}),e.jsxs("span",{className:"text-gray-500",children:["@",(o==null?void 0:o.username)||"user"]}),e.jsx("span",{className:"text-gray-400",children:"·"}),e.jsx("span",{className:"text-gray-500",children:b(a.created_at)})]}),e.jsx("div",{className:"flex items-center space-x-1 mt-0.5",children:e.jsxs("div",{className:"flex items-center space-x-1 text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full",children:[e.jsx("span",{className:"font-semibold",children:s.tweets.length}),e.jsx("span",{children:"tweets"})]})})]})]})})}),e.jsx("div",{className:"relative",children:x.map((t,l)=>{var n,i,p,j,F,M;return e.jsxs("div",{className:"relative",children:[l<x.length-1&&e.jsx("div",{className:"absolute left-7 top-12 w-0.5 h-[calc(100%-48px)] bg-gray-300 z-0"}),e.jsx("div",{className:"relative z-10 px-4 py-3 hover:bg-gray-50/30 transition-colors",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("div",{className:"flex-shrink-0 relative",children:[e.jsxs(L,{className:"h-8 w-8 ring-1 ring-white relative z-10",children:[e.jsx(A,{src:(n=t.author)==null?void 0:n.profile_image_url,alt:(i=t.author)==null?void 0:i.name,className:"object-cover"}),e.jsx(k,{className:"bg-gray-200 text-gray-600 text-xs font-medium",children:((j=(p=t.author)==null?void 0:p.name)==null?void 0:j.charAt(0))||"U"})]}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 h-4 w-4 bg-blue-500 text-white text-xs font-bold rounded-full flex items-center justify-center z-20 border border-white",children:l+1})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsxs("div",{className:"flex items-center space-x-1 min-w-0 text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-900 truncate",children:(F=t.author)==null?void 0:F.name}),e.jsxs("span",{className:"text-gray-500 text-xs",children:["@",(M=t.author)==null?void 0:M.username]}),e.jsx("span",{className:"text-gray-400 text-xs",children:"·"}),e.jsx("span",{className:"text-gray-500 text-xs",children:b(t.created_at)})]})}),e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"text-gray-900 text-sm leading-5 whitespace-pre-wrap break-words",children:u.has(t.id)?e.jsxs("div",{className:"flex items-center text-gray-500 text-xs",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-500 mr-2"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[N(t),(w(t)||(t.full_text||t.text||"").length>240||c.has(t.id))&&e.jsx("button",{onClick:()=>$(t.id),className:"mt-1 text-blue-500 hover:text-blue-600 text-xs font-normal inline-flex items-center space-x-1 transition-colors",disabled:u.has(t.id),children:u.has(t.id)?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-2 w-2 border-b-2 border-blue-500"}),e.jsx("span",{children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:m.has(t.id)?"Show less":"Show more"}),m.has(t.id)?e.jsx(C,{className:"h-3 w-3"}):e.jsx(z,{className:"h-3 w-3"})]})})]})})}),t.media&&t.media.length>0&&e.jsx("div",{className:"mb-2 rounded-xl overflow-hidden border border-gray-200",children:e.jsx(W,{media:t.media})}),e.jsxs("div",{className:"flex items-center justify-between max-w-xs",children:[e.jsxs("button",{className:"flex items-center space-x-1 text-gray-400 hover:text-blue-500 hover:bg-blue-50 px-2 py-1 rounded-full transition-colors group text-xs",children:[e.jsx(R,{className:"h-3 w-3 group-hover:text-blue-500"}),e.jsx("span",{className:"group-hover:text-blue-500",children:t.reply_count||0})]}),e.jsxs("button",{className:"flex items-center space-x-1 text-gray-400 hover:text-green-500 hover:bg-green-50 px-2 py-1 rounded-full transition-colors group text-xs",children:[e.jsx(U,{className:"h-3 w-3 group-hover:text-green-500"}),e.jsx("span",{className:"group-hover:text-green-500",children:t.retweet_count||0})]}),e.jsxs("button",{className:"flex items-center space-x-1 text-gray-400 hover:text-red-500 hover:bg-red-50 px-2 py-1 rounded-full transition-colors group text-xs",children:[e.jsx(O,{className:"h-3 w-3 group-hover:text-red-500"}),e.jsx("span",{className:"group-hover:text-red-500",children:t.favorite_count||0})]}),e.jsxs("button",{className:"flex items-center space-x-1 text-gray-400 hover:text-blue-500 hover:bg-blue-50 px-2 py-1 rounded-full transition-colors group text-xs",children:[e.jsx(H,{className:"h-3 w-3 group-hover:text-blue-500"}),e.jsx("span",{className:"group-hover:text-blue-500",children:t.quote_count||0})]})]})]})]})})]},t.id)})})]})},X=s=>{const d=new Map,y=new Map,x=new Set;s.forEach(r=>y.set(r.id,r)),console.log(`Organizing ${s.length} tweets into threads`);const _=new Map;s.forEach(r=>{if(r.is_self_thread&&r.conversation_id)_.has(r.conversation_id)||_.set(r.conversation_id,new Set),_.get(r.conversation_id).add(r.id),r.in_reply_to_tweet_id&&y.has(r.in_reply_to_tweet_id)&&_.get(r.conversation_id).add(r.in_reply_to_tweet_id);else if(r.in_reply_to_tweet_id&&r.in_reply_to_user_id){const u=y.get(r.in_reply_to_tweet_id);if(u&&u.author.id===r.author.id){const f=r.conversation_id||r.thread_id||r.in_reply_to_tweet_id;_.has(f)||_.set(f,new Set),_.get(f).add(r.id),_.get(f).add(r.in_reply_to_tweet_id)}}}),_.forEach((r,u)=>{if(r.size>1){console.log(`Found self-thread with ID ${u} containing ${r.size} tweets`);const f=Array.from(r).map(c=>y.get(c)).filter(c=>c!==void 0);f.sort((c,g)=>{if(c.thread_position!==void 0&&g.thread_position!==void 0)return c.thread_position-g.thread_position;if(c.thread_index!==void 0&&g.thread_index!==void 0)return c.thread_index-g.thread_index;try{return new Date(c.created_at).getTime()-new Date(g.created_at).getTime()}catch{return Number(BigInt(c.id)-BigInt(g.id))}}),f.length>1&&(f.forEach((c,g)=>{c.thread_position=g,c.thread_index=g,x.add(c.id)}),d.set(u,f))}}),s.forEach(r=>{if(x.has(r.id))return;const u=r.conversation_id||r.thread_id||r.id,f=s.filter(a=>!x.has(a.id)&&(a.conversation_id&&a.conversation_id===u||a.thread_id&&a.thread_id===u||a.in_reply_to_tweet_id&&y.has(a.in_reply_to_tweet_id)&&a.author.id===r.author.id));if(f.length<=1){x.add(r.id),d.has("standalone")||d.set("standalone",[]),d.get("standalone").push(r);return}const c=[],g=new Map;f.forEach(a=>{a.in_reply_to_tweet_id&&(g.has(a.in_reply_to_tweet_id)||g.set(a.in_reply_to_tweet_id,[]),g.get(a.in_reply_to_tweet_id).push(a))});let b=f.find(a=>!a.in_reply_to_tweet_id||!f.some(o=>o.id===a.in_reply_to_tweet_id));if(b||(f.sort((a,o)=>{try{return new Date(a.created_at).getTime()-new Date(o.created_at).getTime()}catch{return Number(BigInt(a.id)-BigInt(o.id))}}),b=f[0]),b){c.push(b),x.add(b.id);const a=(o,T=0)=>{if(T>10)return[];if(!g.has(o))return[];const w=[],$=g.get(o).sort((N,h)=>{try{return new Date(N.created_at).getTime()-new Date(h.created_at).getTime()}catch{return Number(BigInt(N.id)-BigInt(h.id))}});for(const N of $)x.has(N.id)||(w.push(N),x.add(N.id),w.push(...a(N.id,T+1)));return w};c.push(...a(b.id))}else{const a=[...f].sort((o,T)=>{try{return new Date(o.created_at).getTime()-new Date(T.created_at).getTime()}catch{return Number(BigInt(o.id)-BigInt(T.id))}});c.push(...a),a.forEach(o=>x.add(o.id))}c.length>1?(c.forEach((a,o)=>{a.thread_position=o,a.thread_index=o}),d.set(u,c)):c.length===1&&(d.has("standalone")||d.set("standalone",[]),d.get("standalone").push(c[0]))}),s.forEach(r=>{x.has(r.id)||(d.has("standalone")||d.set("standalone",[]),d.get("standalone").push(r),x.add(r.id))});const m=[];return d.forEach((r,u)=>{u==="standalone"?m.push(...r):r.length>1&&m.push({id:u,tweets:r,author:r[0].author,created_at:r[0].created_at})}),console.log(`Organized tweets into ${m.filter(r=>"tweets"in r).length} threads and ${m.filter(r=>!("tweets"in r)).length} standalone tweets`),m.sort((r,u)=>{const f="tweets"in r?new Date(r.tweets[0].created_at).getTime():new Date(r.created_at).getTime();return("tweets"in u?new Date(u.tweets[0].created_at).getTime():new Date(u.created_at).getTime())-f})};export{Q as T,K as a,X as g};
