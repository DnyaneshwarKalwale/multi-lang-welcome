import{j as e}from"./ui-vendor-yLFRes2f.js";import{d as M,u as U,i as W,r as n,R as G}from"./react-vendor-DWSrZqKN.js";import{b as i,r as H,K as J,T as Q,s as g,C as h,M as X,N as Z,O as C,c as y}from"./index-CqPKG3Vx.js";import{A as j,b as O,a as p}from"./alert-vAORvp-v.js";import{m as L}from"./utils-vendor-DFcOAB1P.js";import{C as Y}from"./circle-check-DoblFtsr.js";function le(){var A;const q=M(),l=U(),{token:x}=W(),[R,m]=n.useState(!1),[v,d]=n.useState("pending"),[E,N]=n.useState(null),[c]=n.useState(((A=q.state)==null?void 0:A.email)||localStorage.getItem("pendingVerificationEmail")||null),[f,k]=n.useState(Array(6).fill("")),[b,w]=n.useState(!1),[P,D]=n.useState(0),u=G.useRef([]);n.useEffect(()=>{x&&(async()=>{var r,a;try{m(!0);const t=await C.verifyEmail(x);d("success"),localStorage.setItem("token",t.token),setTimeout(()=>{l("/onboarding/welcome")},2e3)}catch(t){d("error"),N(((a=(r=t.response)==null?void 0:r.data)==null?void 0:a.error)||"Verification failed. Please try again.")}finally{m(!1)}})()},[x,l]);const $=(s,r)=>{var t;if(!/^\d*$/.test(r))return;const a=[...f];a[s]=r,k(a),r&&s<5&&((t=u.current[s+1])==null||t.focus()),a.every(o=>o!=="")&&a.join("").length===6&&T(a.join(""))},z=(s,r)=>{var a;r.key==="Backspace"&&!f[s]&&s>0&&((a=u.current[s-1])==null||a.focus())},F=s=>{var o,V;s.preventDefault();const r=s.clipboardData.getData("text/plain").trim();if(!/^\d+$/.test(r))return;const a=r.slice(0,6).split(""),t=[...f];a.forEach((B,I)=>{I<6&&(t[I]=B)}),k(t),a.length<6?(o=u.current[a.length])==null||o.focus():((V=u.current[5])==null||V.focus(),setTimeout(()=>T(t.join("")),100))},T=async s=>{var r,a;if(!c){y.error("Email address is missing. Please go back to login.");return}try{m(!0);const t=await C.verifyOTP(c,s);d("success"),localStorage.setItem("token",t.token),localStorage.removeItem("pendingVerificationEmail"),setTimeout(()=>{l("/onboarding/welcome")},2e3)}catch(t){d("error"),N(((a=(r=t.response)==null?void 0:r.data)==null?void 0:a.error)||"Verification failed. Please check your code and try again.")}finally{m(!1)}},S=async()=>{var s,r;if(!c){y.error("Email address is missing. Please go back to login.");return}try{w(!0),D(60);const a=await C.resendOTP(c);y.success("A new verification code has been sent to your email");const t=setInterval(()=>{D(o=>o<=1?(clearInterval(t),w(!1),0):o-1)},1e3)}catch(a){y.error(((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.error)||"Failed to resend code. Please try again."),w(!1)}},K={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}};return e.jsxs("div",{className:"min-h-screen bg-background text-foreground flex flex-col items-center p-6 md:p-8 relative",children:[e.jsxs("div",{className:"absolute inset-0 -z-10",children:[e.jsx("div",{className:"absolute top-0 -left-[40%] w-[80%] h-[80%] rounded-full bg-blue-100 dark:bg-blue-900/30 blur-[120px]"}),e.jsx("div",{className:"absolute bottom-0 -right-[40%] w-[80%] h-[80%] rounded-full bg-blue-200 dark:bg-blue-800/20 blur-[120px]"}),e.jsx("div",{className:"absolute inset-0 bg-[url('/patterns/dots.svg')] opacity-5"})]}),e.jsxs(L.div,{className:"self-start mb-8 flex items-center",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},children:[e.jsx(i,{variant:"ghost",size:"icon",rounded:"full",className:"mr-4 flex items-center justify-center w-10 h-10 text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-500 dark:hover:text-blue-400",onClick:()=>l("/"),children:e.jsx(H,{size:18})}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"h-8 text-blue-500"}),e.jsx(Q,{className:"absolute -top-1 -right-6 text-blue-500 bg-white dark:bg-gray-900 p-1 rounded-full w-5 h-5 shadow-sm"})]})]}),e.jsx(L.div,{className:"max-w-md w-full flex flex-col items-center",variants:K,initial:"hidden",animate:"visible",children:x?R?e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 rounded-full p-4 mb-6",children:e.jsx(g,{className:"h-12 w-12 text-blue-500 animate-spin"})}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100",children:"Verifying your email"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-8 text-center",children:"Please wait while we verify your email address..."}),e.jsx("div",{className:"w-full max-w-sm bg-gray-100 dark:bg-gray-800 h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-blue-500 h-full animate-pulse",style:{width:"60%"}})})]}):v==="success"?e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 rounded-full p-4 mb-6",children:e.jsx(Y,{className:"h-12 w-12 text-green-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100",children:"Email verified successfully!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6 text-center",children:"Your email has been verified. You'll be redirected to continue the onboarding process."}),e.jsxs(j,{variant:"default",className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 mb-6 text-blue-800 dark:text-blue-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4 animate-spin"}),e.jsx(O,{children:"Redirecting you..."})]}),e.jsx(p,{children:"You'll be redirected automatically in a few seconds."})]}),e.jsx(i,{onClick:()=>l("/onboarding/welcome"),variant:"linkedin",rounded:"full",className:"py-3 px-8 font-bold",children:"Continue to onboarding"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"bg-red-100 dark:bg-red-900/30 rounded-full p-4 mb-6",children:e.jsx(h,{className:"h-12 w-12 text-red-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100",children:"Verification failed"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6 text-center",children:E||"An error occurred during verification."}),e.jsxs(j,{variant:"destructive",className:"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 mb-8 text-red-800 dark:text-red-300",children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),e.jsx(p,{children:"The verification link may be expired or invalid. Please try again or request a new verification email."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full",children:[e.jsx(i,{onClick:()=>l("/"),variant:"outline",rounded:"full",className:"flex-1 py-3 border-gray-300 dark:border-gray-700",children:"Return to login"}),e.jsx(i,{onClick:()=>l("/"),variant:"linkedin",rounded:"full",className:"flex-1 py-3 font-bold",children:"Request new code"})]})]}):R?e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 rounded-full p-4 mb-6",children:e.jsx(g,{className:"h-12 w-12 text-blue-500 animate-spin"})}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100",children:"Verifying your code"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-8 text-center",children:"Please wait while we verify your code..."}),e.jsx("div",{className:"w-full max-w-sm bg-gray-100 dark:bg-gray-800 h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-blue-500 h-full animate-pulse",style:{width:"60%"}})})]}):v==="success"?e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 rounded-full p-4 mb-6",children:e.jsx(Y,{className:"h-12 w-12 text-green-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100",children:"Email verified successfully!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6 text-center",children:"Your email has been verified. You'll be redirected to continue the onboarding process."}),e.jsxs(j,{variant:"default",className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 mb-6 text-blue-800 dark:text-blue-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4 animate-spin"}),e.jsx(O,{children:"Redirecting you..."})]}),e.jsx(p,{children:"You'll be redirected automatically in a few seconds."})]}),e.jsx(i,{onClick:()=>l("/onboarding/welcome"),variant:"linkedin",rounded:"full",className:"py-3 px-8 font-bold",children:"Continue to onboarding"})]}):v==="error"?e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"bg-red-100 dark:bg-red-900/30 rounded-full p-4 mb-6",children:e.jsx(h,{className:"h-12 w-12 text-red-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100",children:"Verification failed"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6 text-center",children:E||"Invalid verification code."}),e.jsxs(j,{variant:"destructive",className:"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 mb-8 text-red-800 dark:text-red-300",children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),e.jsx(p,{children:"The verification code is incorrect or has expired. Please check your email for the latest code or request a new one."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full",children:[e.jsx(i,{onClick:()=>{d("pending"),k(Array(6).fill("")),N(null)},variant:"outline",rounded:"full",className:"flex-1 py-3 border-gray-300 dark:border-gray-700",children:"Try again"}),e.jsx(i,{onClick:S,variant:"linkedin",rounded:"full",className:"flex-1 py-3 font-bold",disabled:b,children:b?`Resend code (${P}s)`:"Resend code"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-4 mb-6",children:e.jsx(X,{className:"h-12 w-12 text-blue-500"})}),e.jsx("h1",{className:"text-3xl font-bold mb-6 text-gray-900",children:"Verify your email"}),e.jsxs("p",{className:"text-gray-600 mb-8 text-center",children:["We've sent a verification code to ",e.jsx("span",{className:"font-bold text-blue-500",children:c||"your email address"}),". Enter the 6-digit code below to verify your account."]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 w-full mb-8",children:[e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:e.jsx("span",{className:"font-bold",children:"Enter the code from your email"})}),e.jsx("div",{className:"flex gap-2 mb-6 justify-center",onPaste:F,children:f.map((s,r)=>e.jsx(Z,{type:"text",className:"w-12 h-12 text-center text-xl font-bold bg-white",maxLength:1,value:s,ref:a=>u.current[r]=a,onChange:a=>$(r,a.target.value),onKeyDown:a=>z(r,a),autoFocus:r===0},r))}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg text-sm text-gray-500",children:"Didn't receive a code? Check your spam folder or request a new code."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full",children:[e.jsx(i,{onClick:()=>l("/"),variant:"outline",rounded:"full",className:"flex-1 py-3 border-blue-500 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/10",children:"Return to login"}),e.jsx(i,{onClick:S,variant:"linkedin",rounded:"full",className:"flex-1 py-3 font-bold",disabled:b,children:b?`Resend code (${P}s)`:"Resend code"})]})]})})]})}export{le as default};
