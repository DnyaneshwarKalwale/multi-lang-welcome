import{j as e}from"./ui-vendor-yLFRes2f.js";import{u as He,d as Be,r as x}from"./react-vendor-DWSrZqKN.js";import{k as Ce,a as Ue,ac as We,c as h,aq as B,aA as Ve,aB as Re,aC as Je,b as j,al as Ye,am as qe,aD as Ge,an as Ze,ao as Ke,au as Ne,aw as Qe,aE as Xe,aF as es,aG as ie,n as ss,ak as U,s as V,C as ts,L as as,a3 as ls,a4 as is,a5 as oe,F as De,a6 as re,Y as os,a0 as rs,a1 as ns,a2 as cs,ae as ds,N as ye,af as hs,ag as us,ah as ms,ai as gs,aj as ne,aa as ps,aH as fs,j as xs}from"./index-CisuWjtJ.js";import{l as P}from"./linkedinApi-B-f21A0e.js";import{T as Y}from"./trash-C0cjvCj9.js";import{S as q}from"./send-BY59xh0O.js";import{C as Ie}from"./circle-check-DPzwxUSs.js";import"./utils-vendor-DFcOAB1P.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=Ce("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=Ce("PencilLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}],["path",{d:"m15 5 3 3",key:"1w25hb"}]]),ws=({slides:S})=>{const[Z,N]=x.useState(0),w=()=>{N(b=>b===S.length-1?0:b+1)},A=()=>{N(b=>b===0?S.length-1:b-1)};return!S||S.length===0?e.jsx("div",{className:"relative rounded-md overflow-hidden border bg-white min-h-[280px] flex items-center justify-center",children:e.jsx("p",{className:"text-gray-400",children:"No slides available"})}):e.jsxs("div",{className:"relative rounded-md overflow-hidden border bg-white",children:[e.jsxs("div",{className:"relative min-h-[280px] w-full",children:[S.map((b,v)=>e.jsxs("div",{className:`absolute top-0 left-0 w-full transition-opacity duration-300 ${v===Z?"opacity-100 z-10":"opacity-0 z-0"}`,children:[b.cloudinaryImage&&e.jsx("img",{src:b.cloudinaryImage.secure_url,alt:`Slide ${v+1}`,className:"w-full object-contain max-h-[240px]"}),e.jsx("div",{className:"p-3 bg-white text-sm",children:b.content})]},b.id)),S.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:b=>{b.stopPropagation(),A()},className:"absolute left-2 top-1/2 -translate-y-1/2 z-20 h-8 w-8 rounded-full bg-white/70 flex items-center justify-center","aria-label":"Previous slide",children:e.jsx(fs,{size:18})}),e.jsx("button",{onClick:b=>{b.stopPropagation(),w()},className:"absolute right-2 top-1/2 -translate-y-1/2 z-20 h-8 w-8 rounded-full bg-white/70 flex items-center justify-center","aria-label":"Next slide",children:e.jsx(xs,{size:18})})]})]}),e.jsx("div",{className:"flex gap-1 justify-center my-2",children:S.map((b,v)=>e.jsx("div",{className:`h-1.5 rounded-full ${v===Z?"w-4 bg-blue-500":"w-1.5 bg-gray-300"}`,onClick:()=>N(v)},v))})]})},Cs=()=>{const S=He(),N=Be().state,{user:w}=Ue(),{updatePostCounts:A}=We(),[b,v]=x.useState((N==null?void 0:N.activeTab)||"drafts"),[ke,ce]=x.useState(!0),[L,$]=x.useState([]),[T,E]=x.useState([]),[_,y]=x.useState([]),[W,R]=x.useState(!1),[Ae,z]=x.useState(!1),[Le,Te]=x.useState(!1),[de,he]=x.useState(!1),[ue,J]=x.useState(!1),[p,Ee]=x.useState(null),[F,me]=x.useState(()=>{const s=new Date;return s.setHours(0,0,0,0),s}),[K,ge]=x.useState(()=>{const s=new Date;s.setMinutes(s.getMinutes()+15);const l=String(s.getHours()).padStart(2,"0"),r=String(s.getMinutes()).padStart(2,"0");return`${l}:${r}`}),[pe,fe]=x.useState("PUBLIC"),[xe,be]=x.useState(!1);x.useEffect(()=>{N&&(N.activeTab?v(N.activeTab):N.newPost?v("published"):N.scheduled?v("scheduled"):N.newDraft&&v("drafts"))},[N]),x.useEffect(()=>{I()},[]),x.useEffect(()=>{console.log("Active tab changed to:",b),I()},[b]);const Oe=async()=>{try{he(!0),h.info("Migrating posts to the database...");const s=await P.migrateLocalPostsToDatabase();s.success?(h.success(`Successfully migrated ${s.migratedCount} posts to the database`),await I(),A()):h.error("Failed to migrate some posts. Please try again later.")}catch(s){console.error("Error migrating posts:",s),h.error("Failed to migrate posts. Please try again later.")}finally{he(!1)}},$e=()=>{const l="https://api.brandout.ai/api".replace("/api","");localStorage.setItem("redirectAfterAuth","/dashboard/posts"),window.location.href=`${l}/api/auth/linkedin-direct`},D=s=>s.slides!==void 0&&Array.isArray(s.slides)&&s.slides.length>0&&s.slides.some(l=>{var r,c;return(((r=l.cloudinaryImage)==null?void 0:r.secure_url)||l.imageUrl)&&((c=l.content)==null?void 0:c.trim().length)>0}),I=async()=>{var s,l,r;try{if(ce(!0),!localStorage.getItem("linkedin-login-token")){Te(!0),h.error("LinkedIn authentication required to load your content");return}try{const n=await P.getDBPosts("draft"),o=await P.getDBPosts("scheduled"),d=await P.getDBPosts("published");console.log("Published data from API:",d);const t=((s=n==null?void 0:n.data)==null?void 0:s.map(a=>{var m;return{id:a._id,title:a.title||"Draft Post",content:a.content,excerpt:((m=a.content)==null?void 0:m.substring(0,100))+"...",createdAt:a.createdAt,updatedAt:a.updatedAt,slides:a.slides||[],postImage:a.postImage,isPollActive:a.isPollActive,pollOptions:a.pollOptions,hashtags:a.hashtags,visibility:a.visibility,provider:a.platform,status:"draft",date:new Date(a.createdAt).toLocaleDateString(),platformPostId:a.platformPostId}}))||[],O=((l=o==null?void 0:o.data)==null?void 0:l.map(a=>{var m;return{id:a._id,title:a.title||"Scheduled Post",content:a.content,excerpt:((m=a.content)==null?void 0:m.substring(0,100))+"...",createdAt:a.createdAt,updatedAt:a.updatedAt,scheduledTime:a.scheduledTime,slides:a.slides||[],postImage:a.postImage,isPollActive:a.isPollActive,pollOptions:a.pollOptions,hashtags:a.hashtags,visibility:a.visibility,provider:a.platform,status:"scheduled",scheduledDate:new Date(a.scheduledTime).toLocaleDateString(),platformPostId:a.platformPostId}}))||[],H=((r=d==null?void 0:d.data)==null?void 0:r.map(a=>{var C,Pe;const m=a.slides&&Array.isArray(a.slides)&&a.slides.length>0&&a.slides.some(ve=>{var Se;return((Se=ve.cloudinaryImage)==null?void 0:Se.secure_url)||ve.imageUrl});let g="none";return m?g="carousel":a.postImage&&a.postImage.secure_url&&(g="image"),console.log(`Post ${a._id} media type: ${g}, hasValidSlides: ${m}`),{id:a._id,title:a.title||"Published Post",content:a.content,excerpt:((C=a.content)==null?void 0:C.substring(0,100))+"...",createdAt:a.createdAt,updatedAt:a.updatedAt,publishedDate:a.publishedTime?new Date(a.publishedTime).toLocaleDateString():new Date(a.updatedAt).toLocaleDateString(),slides:a.slides||[],postImage:a.postImage,isPollActive:a.isPollActive,pollOptions:a.pollOptions,hashtags:a.hashtags,visibility:a.visibility,provider:a.platform,status:"published",isCarousel:m,slideCount:((Pe=a.slides)==null?void 0:Pe.length)||0,mediaType:g,platformPostId:a.platformPostId}}))||[];console.log("Processed published posts:",H),$(t),E(O),y(H);const le=new Set(t.map(a=>a.id)),i=new Map;t.forEach(a=>{const m=a.content?`${a.content.substring(0,50)}`:"";m&&i.set(m,!0)});const u=new Set(O.map(a=>a.id)),f=new Map;O.forEach(a=>{const m=a.content?`${a.content.substring(0,50)}`:"";m&&f.set(m,!0)}),console.log("Checking localStorage for any additional posts...");const k=[],M=[];for(let a=0;a<localStorage.length;a++){const m=localStorage.key(a);if(m!=null&&m.startsWith("draft_"))try{const g=JSON.parse(localStorage.getItem(m)||"{}");if(g.id)if(le.has(g.id))console.log("Skipping duplicate draft with ID:",g.id),localStorage.removeItem(m);else{const C=g.content?`${g.content.substring(0,50)}`:"";!C||!i.has(C)?(k.push(g),C&&i.set(C,!0)):(console.log("Skipping duplicate draft based on content:",g.id),localStorage.removeItem(m))}}catch(g){console.error("Error parsing draft:",g)}else if(m!=null&&m.startsWith("scheduled_"))try{const g=JSON.parse(localStorage.getItem(m)||"{}");if(g.id)if(u.has(g.id))console.log("Skipping duplicate scheduled post with ID:",g.id),localStorage.removeItem(m);else{const C=g.content?`${g.content.substring(0,50)}`:"";!C||!f.has(C)?(M.push(g),C&&f.set(C,!0)):(console.log("Skipping duplicate scheduled post based on content:",g.id),localStorage.removeItem(m))}}catch(g){console.error("Error parsing scheduled post:",g)}}k.length>0&&$(a=>[...a,...k]),M.length>0&&E(a=>[...a,...M])}catch(n){console.error("Error loading content:",n),h.error("Failed to load your content"),we()}A()}catch(c){console.error("Error in loadUserContent:",c),h.error("Failed to load content"),we()}finally{ce(!1)}},we=()=>{console.log("Falling back to localStorage for posts...");const s=[],l=[],r=new Map,c=new Map;for(let n=0;n<localStorage.length;n++){const o=localStorage.key(n);if(o!=null&&o.startsWith("draft_"))try{const d=JSON.parse(localStorage.getItem(o)||"{}");if(d.id){const t=d.content?`${d.content.substring(0,50)}`:"";!t||!r.has(t)?(s.push(d),t&&r.set(t,!0)):(console.log("Skipping duplicate draft in localStorage:",d.id),localStorage.removeItem(o))}}catch(d){console.error("Error parsing draft:",d)}else if(o!=null&&o.startsWith("scheduled_"))try{const d=JSON.parse(localStorage.getItem(o)||"{}");if(d.id){const t=d.content?`${d.content.substring(0,50)}`:"";!t||!c.has(t)?(l.push(d),t&&c.set(t,!0)):(console.log("Skipping duplicate scheduled post in localStorage:",d.id),localStorage.removeItem(o))}}catch(d){console.error("Error parsing scheduled post:",d)}}s.length>0&&$(s),l.length>0&&E(l)},Q=s=>{var r;const l=L.find(c=>c.id===s);l&&(Object.keys(localStorage).forEach(c=>{c.startsWith("state:createPost.")&&localStorage.removeItem(c)}),Object.entries(l).forEach(([c,n])=>{c!=="id"&&c!=="createdAt"&&c!=="updatedAt"&&c!=="status"&&n!=null&&localStorage.setItem(`state:createPost.${c}`,JSON.stringify(n))}),localStorage.setItem("editingDraftId",s),S("/dashboard/post",{state:{content:l.content,hashtags:l.hashtags,image:(r=l.postImage)==null?void 0:r.secure_url}}))},je=async s=>{try{z(!0);const l=L.filter(r=>r.id!==s);$(l),s.startsWith("draft_")?(localStorage.removeItem(s),h.success("Draft deleted successfully")):(await P.deleteDBPost(s),h.success("Draft deleted successfully")),A()}catch(l){console.error("Error deleting draft:",l),h.error("Failed to delete draft");const r=L.find(c=>c.id===s);r&&$(c=>[...c,r])}finally{z(!1)}},X=async s=>{const l=L.find(r=>r.id===s);l&&Me(l)},ee=async s=>{var c;const l=T.find(n=>n.id===s);if(!l)return;const r=T.filter(n=>n.id!==s);if(E(r),Object.keys(localStorage).forEach(n=>{n.startsWith("state:createPost.")&&localStorage.removeItem(n)}),Object.entries(l).forEach(([n,o])=>{n!=="id"&&n!=="createdAt"&&n!=="updatedAt"&&n!=="status"&&n!=="scheduledTime"&&o!=null&&localStorage.setItem(`state:createPost.${n}`,JSON.stringify(o))}),l.scheduledTime){const n=new Date(l.scheduledTime),o=n.getHours().toString().padStart(2,"0"),d=n.getMinutes().toString().padStart(2,"0");localStorage.setItem("state:createPost.scheduleTime",JSON.stringify(`${o}:${d}`)),localStorage.setItem("state:createPost.scheduledDate",JSON.stringify(n.toISOString()))}try{s.startsWith("scheduled_")?localStorage.removeItem(s):await P.deleteDBPost(s),localStorage.setItem("editingScheduledId",s),S("/dashboard/post",{state:{content:l.content,hashtags:l.hashtags,image:(c=l.postImage)==null?void 0:c.secure_url,openScheduleDialog:!0,scheduledDate:l.scheduledTime,scheduleTime:`${F.getHours().toString().padStart(2,"0")}:${F.getMinutes().toString().padStart(2,"0")}`}})}catch(n){console.error("Error removing scheduled post:",n),h.error("Failed to edit scheduled post. Please try again later."),l&&E(o=>[...o,l])}},_e=async s=>{try{z(!0);const l=T.filter(r=>r.id!==s);E(l),s.startsWith("scheduled_")?(localStorage.removeItem(s),h.success("Scheduled post deleted successfully")):(await P.deleteDBPost(s),h.success("Scheduled post deleted successfully")),A()}catch(l){console.error("Error deleting scheduled post:",l),h.error("Failed to delete scheduled post");const r=T.find(c=>c.id===s);r&&E(c=>[...c,r])}finally{z(!1)}},se=async s=>{var l,r,c,n,o,d;if(window.confirm("Are you sure you want to publish this draft to LinkedIn now?"))try{R(!0);const t=L.find(i=>i.id===s);if(!t)throw new Error("Draft not found");const O=L.filter(i=>i.id!==s);$(O);const H={id:`temp_${s}`,title:t.title||"Publishing...",content:t.content,excerpt:((l=t.content)==null?void 0:l.substring(0,100))+"...",publishedDate:new Date().toLocaleDateString(),isCarousel:D(t),slideCount:D(t)&&((r=t.slides)==null?void 0:r.length)||0,status:"published",postImage:t.postImage,hashtags:t.hashtags,isPollActive:t.isPollActive,pollOptions:t.pollOptions,platformPostId:t.platformPostId};if(y(i=>[H,...i]),v("published"),s.startsWith("draft_"))try{console.log("Migrating local draft before publishing");const i=await P.migrateSinglePostToDatabase(t);if(i.success&&i.migratedPost){const u=i.migratedPost.dbId;if(!u)throw new Error("Failed to get database ID for migrated post");console.log("Local post migrated successfully, publishing with DB ID:",u);const f=await P.publishDBPost(u);if(f.success){localStorage.removeItem(s);const k=_.filter(a=>a.id!==`temp_${s}`),M={id:f.data._id,title:t.title||"Published Post",content:t.content,excerpt:((c=t.content)==null?void 0:c.substring(0,100))+"...",publishedDate:new Date().toLocaleDateString(),isCarousel:D(t),slideCount:D(t)&&((n=t.slides)==null?void 0:n.length)||0,status:"published",postImage:t.postImage,hashtags:t.hashtags,isPollActive:t.isPollActive,pollOptions:t.pollOptions,platformPostId:t.platformPostId};y([M,...k]),h.success("Post published to LinkedIn successfully"),await I()}else throw new Error("Failed to publish post after migration")}else throw new Error("Failed to migrate post")}catch(i){console.error("Error publishing draft after migration:",i),h.error("Failed to publish post: "+(i.message||"Unknown error")),$(u=>[t,...u]),y(u=>u.filter(f=>f.id!==`temp_${s}`))}else try{const i=await P.publishDBPost(s);if(console.log("Published post response:",i),i.success&&i.data){const u=_.filter(k=>k.id!==`temp_${s}`),f={id:i.data._id,title:i.data.title||t.title||"Published Post",content:i.data.content||t.content,excerpt:((o=i.data.content||t.content)==null?void 0:o.substring(0,100))+"...",publishedDate:i.data.publishedTime?new Date(i.data.publishedTime).toLocaleDateString():new Date().toLocaleDateString(),isCarousel:D(t),slideCount:D(t)&&((d=t.slides)==null?void 0:d.length)||0,status:"published",postImage:i.data.postImage||t.postImage,hashtags:i.data.hashtags||t.hashtags,isPollActive:i.data.isPollActive||t.isPollActive,pollOptions:i.data.pollOptions||t.pollOptions,platformPostId:t.platformPostId};y([f,...u]),h.success("Post published to LinkedIn successfully"),await I(),setTimeout(()=>{I()},1e3)}else throw new Error("Invalid response from server when publishing post")}catch(i){console.error("Error publishing draft:",i),h.error("Failed to publish post: "+(i.message||"Unknown error")),$(u=>[t,...u]),y(u=>u.filter(f=>f.id!==`temp_${s}`))}A()}catch(t){console.error("Error publishing draft:",t),h.error("Failed to publish post: "+(t.message||"Unknown error"))}finally{R(!1)}},te=async s=>{var l,r,c,n,o,d;if(window.confirm("Are you sure you want to publish this scheduled post to LinkedIn now?"))try{R(!0);const t=T.find(i=>i.id===s);if(!t)throw new Error("Scheduled post not found");const O=T.filter(i=>i.id!==s);E(O);const H={id:`temp_${s}`,title:t.title||"Publishing...",content:t.content,excerpt:((l=t.content)==null?void 0:l.substring(0,100))+"...",publishedDate:new Date().toLocaleDateString(),isCarousel:D(t),slideCount:D(t)&&((r=t.slides)==null?void 0:r.length)||0,status:"published",postImage:t.postImage,hashtags:t.hashtags,isPollActive:t.isPollActive,pollOptions:t.pollOptions,platformPostId:t.platformPostId};if(y(i=>[H,...i]),v("published"),s.startsWith("scheduled_"))try{console.log("Migrating local scheduled post before publishing");const i=await P.migrateSinglePostToDatabase(t);if(i.success&&i.migratedPost){const u=i.migratedPost.dbId;if(!u)throw new Error("Failed to get database ID for migrated post");console.log("Local post migrated successfully, publishing with DB ID:",u);const f=await P.publishDBPost(u);if(f.success){localStorage.removeItem(s);const k=_.filter(a=>a.id!==`temp_${s}`),M={id:f.data._id,title:t.title||"Published Post",content:t.content,excerpt:((c=t.content)==null?void 0:c.substring(0,100))+"...",publishedDate:new Date().toLocaleDateString(),isCarousel:D(t),slideCount:D(t)&&((n=t.slides)==null?void 0:n.length)||0,status:"published",postImage:t.postImage,hashtags:t.hashtags,isPollActive:t.isPollActive,pollOptions:t.pollOptions,platformPostId:t.platformPostId};y([M,...k]),h.success("Post published to LinkedIn successfully"),await I(),setTimeout(()=>{I()},1e3)}else throw new Error("Failed to publish post after migration")}else throw new Error("Failed to migrate post")}catch(i){console.error("Error publishing scheduled post after migration:",i),h.error("Failed to publish post: "+(i.message||"Unknown error")),E(u=>[t,...u]),y(u=>u.filter(f=>f.id!==`temp_${s}`))}else try{const i=await P.publishDBPost(s);if(console.log("Published scheduled post response:",i),i.success&&i.data){const u=_.filter(k=>k.id!==`temp_${s}`),f={id:i.data._id,title:i.data.title||t.title||"Published Post",content:i.data.content||t.content,excerpt:((o=i.data.content||t.content)==null?void 0:o.substring(0,100))+"...",publishedDate:i.data.publishedTime?new Date(i.data.publishedTime).toLocaleDateString():new Date().toLocaleDateString(),isCarousel:D(t),slideCount:D(t)&&((d=t.slides)==null?void 0:d.length)||0,status:"published",postImage:i.data.postImage||t.postImage,hashtags:i.data.hashtags||t.hashtags,isPollActive:i.data.isPollActive||t.isPollActive,pollOptions:i.data.pollOptions||t.pollOptions,platformPostId:t.platformPostId};y([f,...u]),h.success("Scheduled post published to LinkedIn successfully"),await I(),setTimeout(()=>{I()},1e3)}else throw new Error("Invalid response from server when publishing post")}catch(i){console.error("Error publishing scheduled post:",i),h.error("Failed to publish post: "+(i.message||"Unknown error")),E(u=>[t,...u]),y(u=>u.filter(f=>f.id!==`temp_${s}`))}A()}catch(t){console.error("Error publishing scheduled post:",t),h.error("Failed to publish post: "+(t.message||"Unknown error"))}finally{R(!1)}},Fe=async s=>{try{z(!0);const l=_.filter(r=>r.id!==s.id);y(l),await P.deleteDBPost(s.id),h.success("Post deleted successfully"),A()}catch(l){console.error("Error deleting published post:",l),h.error("Failed to delete post"),s&&y(r=>[...r,s])}finally{z(!1)}},ae=x.useCallback((s,l)=>{var n;let r="none";D(s)?r="carousel":s.postImage&&s.postImage.secure_url?r="image":s.mediaType&&(r=s.mediaType),console.log(`Rendering ${l} post ${s.id} with media type: ${r}`);const c=()=>{if(l==="draft")return[{id:"edit",label:"Edit Draft",icon:e.jsx(G,{size:14}),onClick:()=>Q(s.id)},{id:"schedule",label:"Schedule",icon:e.jsx(U,{size:14}),onClick:()=>X(s.id)},{id:"publish",label:"Publish Now",icon:e.jsx(q,{size:14}),onClick:()=>se(s.id)},{id:"delete",label:"Delete Draft",icon:e.jsx(Y,{size:14}),className:"text-red-500 hover:text-red-700",onClick:()=>je(s.id)}];if(l==="scheduled")return[{id:"edit",label:"Edit Scheduled Post",icon:e.jsx(G,{size:14}),onClick:()=>ee(s.id)},{id:"publish",label:"Publish Now",icon:e.jsx(q,{size:14}),onClick:()=>te(s.id)},{id:"delete",label:"Delete Scheduled Post",icon:e.jsx(Y,{size:14}),className:"text-red-500 hover:text-red-700",onClick:()=>_e(s.id)}];if(l==="published"){const o=[];return s.platformPostId&&o.push({id:"view",label:"View on LinkedIn",icon:e.jsx(ie,{size:14}),onClick:()=>{window.open(`https://www.linkedin.com/feed/update/${s.platformPostId}`,"_blank")}}),o.push({id:"delete",label:"Delete Post",icon:e.jsx(Y,{size:14}),className:"text-red-500 hover:text-red-700",onClick:()=>Fe(s)}),o}return[]};return e.jsxs(B,{className:"overflow-hidden h-full min-h-[500px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center p-3 sm:p-4 border-b",children:[e.jsxs(Ve,{className:"h-8 w-8 sm:h-10 sm:w-10 mr-2 sm:mr-3",children:[e.jsx(Re,{src:(w==null?void 0:w.profilePicture)||"/placeholder-avatar.png",alt:`${w==null?void 0:w.firstName} ${w==null?void 0:w.lastName}`||"User"}),e.jsx(Je,{children:((n=w==null?void 0:w.firstName)==null?void 0:n[0])||"U"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-medium truncate",children:w?`${w.firstName} ${w.lastName}`:"User"}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[l==="published"?"Posted":l==="scheduled"?"Scheduled":"Draft"," Â· ",l==="scheduled"&&s.scheduledTime?new Date(s.scheduledTime).toLocaleString():new Date(s.updatedAt).toLocaleDateString()]})]}),l==="draft"?e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 flex-shrink-0 ml-1 text-gray-500 hover:text-red-500 hover:bg-red-50 transition-colors",onClick:()=>je(s.id),children:e.jsx(Y,{size:16})}):e.jsxs(Ye,{children:[e.jsx(qe,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 flex-shrink-0 ml-1",children:e.jsx(Ge,{size:16})})}),e.jsx(Ze,{align:"end",children:c().map(o=>e.jsxs(Ke,{className:o.className,onClick:o.onClick,children:[o.icon&&e.jsx("span",{className:"mr-2",children:o.icon}),o.label]},o.id))})]})]}),e.jsxs(Ne,{className:"p-3 sm:p-4 flex-grow overflow-auto space-y-4",children:[e.jsx("div",{className:"text-sm whitespace-pre-wrap",children:s.content||s.excerpt||"No content"}),s.postImage&&r==="image"&&e.jsx("div",{className:"rounded-md overflow-hidden border bg-white",children:e.jsx("img",{src:s.postImage.secure_url,alt:"Post image",className:"w-full object-contain max-h-[200px] sm:max-h-[280px]"})}),r==="carousel"&&s.slides&&s.slides.length>0&&e.jsx(ws,{slides:s.slides||[]}),s.hashtags&&s.hashtags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.hashtags.map(o=>e.jsxs(Qe,{variant:"secondary",className:"rounded-sm text-xs font-medium text-blue-600 bg-transparent hover:bg-blue-50",children:["#",o]},o))}),s.isPollActive&&s.pollOptions&&s.pollOptions.length>0&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-md border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Xe,{size:14}),e.jsx("span",{className:"text-sm font-medium",children:"Poll"})]}),e.jsx("div",{className:"space-y-2",children:s.pollOptions.map((o,d)=>e.jsx("div",{className:"text-sm p-2 bg-white rounded border flex justify-between items-center",children:e.jsx("span",{children:o})},d))})]})]}),e.jsx(es,{className:"p-0 border-t mt-auto",children:l==="published"?e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between p-1",children:[s.platformPostId?e.jsxs(j,{variant:"ghost",size:"sm",className:"flex-1 rounded-md gap-1",onClick:()=>window.open(`https://www.linkedin.com/feed/update/${s.platformPostId}`,"_blank"),children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"View on LinkedIn"})]}):e.jsxs(j,{variant:"ghost",size:"sm",className:"flex-1 rounded-md gap-1 opacity-50 cursor-not-allowed",disabled:!0,children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Link Unavailable"})]}),e.jsxs(j,{variant:"ghost",size:"sm",className:"flex-1 rounded-md gap-1",children:[e.jsx(ss,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Duplicate"})]})]})}):e.jsxs("div",{className:"w-full",children:[l==="draft"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-1 p-2",children:[e.jsxs(j,{variant:"outline",onClick:()=>Q(s.id),className:"h-9 text-xs",children:[e.jsx(G,{size:12,className:"mr-1"})," Edit"]}),e.jsxs(j,{variant:"outline",onClick:()=>X(s.id),className:"h-9 text-xs",children:[e.jsx(U,{size:12,className:"mr-1"})," Schedule"]}),e.jsxs(j,{variant:"default",onClick:()=>se(s.id),className:"h-9 text-xs",disabled:W,children:[W?e.jsx(V,{className:"h-3 w-3 mr-1 animate-spin"}):e.jsx(q,{size:12,className:"mr-1"}),"Publish"]})]}),l==="scheduled"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1 p-2",children:[e.jsxs(j,{variant:"outline",onClick:()=>ee(s.id),className:"h-9 text-xs",children:[e.jsx(G,{size:12,className:"mr-1"})," Edit"]}),e.jsxs(j,{variant:"default",onClick:()=>te(s.id),className:"h-9 text-xs",disabled:W,children:[W?e.jsx(V,{className:"h-3 w-3 mr-1 animate-spin"}):e.jsx(q,{size:12,className:"mr-1"}),"Publish Now"]})]})]})})]},s.id)},[W,Ae,w,L,T,_,Q,X,se,ee,te]),Me=s=>{Ee(s),J(!0),s.visibility&&fe(s.visibility)},ze=async()=>{if(!p){h.error("No draft selected for scheduling");return}try{be(!0);const s=new Date(F),[l,r]=K.split(":").map(Number);if(s.setHours(l,r,0,0),s<=new Date){h.error("Please select a future date and time");return}const c={title:p.title||"Scheduled Post",content:p.content||"",hashtags:p.hashtags||[],visibility:pe,platform:"linkedin",status:"scheduled",scheduledTime:s.toISOString(),mediaType:p.postImage?"image":D(p)?"carousel":"none",postImage:p.postImage,slides:p.slides||[],isPollActive:p.isPollActive||!1,pollOptions:p.pollOptions||[]};p.id.startsWith("draft_")?localStorage.removeItem(p.id):await P.deleteDBPost(p.id);const n=await P.createDBPost({...c,status:"scheduled"});if(n&&n.success)$(o=>o.filter(d=>d.id!==p.id)),h.success("Post scheduled successfully!"),J(!1),await I(),v("scheduled"),setTimeout(()=>{I()},1e3),A();else throw new Error("Failed to schedule post")}catch(s){console.error("Error scheduling post:",s),h.error("Failed to schedule post: "+(s.message||"Unknown error"))}finally{be(!1)}};return e.jsxs("div",{className:"container mx-auto px-2 sm:px-4 py-6 sm:py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-neutral-black",children:"Post Library"}),e.jsxs("div",{className:"flex gap-2",children:[(L.some(s=>s.id.startsWith("draft_"))||T.some(s=>s.id.startsWith("scheduled_")))&&e.jsxs(j,{variant:"outline",onClick:Oe,disabled:de,className:"flex items-center gap-1 text-xs sm:text-sm",children:[de?e.jsx(V,{className:"h-3 w-3 animate-spin"}):e.jsx(bs,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Migrate Local Posts"}),e.jsx("span",{className:"inline sm:hidden",children:"Migrate"})]}),e.jsx(j,{onClick:()=>S("/dashboard/post"),className:"bg-primary text-white text-xs sm:text-sm",children:"Create New Post"})]})]}),Le&&e.jsx(B,{className:"mb-6 border-amber-200 bg-amber-50",children:e.jsx(Ne,{className:"p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(ts,{className:"h-5 w-5 text-amber-500 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-amber-800 mb-1",children:"LinkedIn Authentication Required"}),e.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"Your LinkedIn connection has expired or is missing required permissions. Please reconnect your account to publish posts."}),e.jsxs(j,{className:"bg-amber-600 hover:bg-amber-700 text-white",onClick:$e,children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Reconnect LinkedIn"]})]})]})})}),e.jsxs(ls,{value:b,className:"w-full",onValueChange:v,children:[e.jsxs(is,{className:"grid w-full grid-cols-3 mb-8",children:[e.jsxs(oe,{value:"drafts",className:"flex gap-2 items-center",children:[e.jsx(De,{size:16}),"Drafts"]}),e.jsxs(oe,{value:"scheduled",className:"flex gap-2 items-center",children:[e.jsx(U,{size:16}),"Scheduled"]}),e.jsxs(oe,{value:"published",className:"flex gap-2 items-center",children:[e.jsx(Ie,{size:16}),"Published"]})]}),e.jsx(re,{value:"drafts",children:ke?e.jsx(B,{className:"p-6",children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(V,{className:"h-8 w-8 animate-spin text-primary"})})}):L.length===0?e.jsx(B,{className:"p-6 text-center",children:e.jsxs("div",{className:"py-8",children:[e.jsx(De,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No drafts yet"}),e.jsx("p",{className:"text-neutral-medium text-sm mb-4",children:"Start creating content for LinkedIn"}),e.jsx(j,{onClick:()=>S("/dashboard/post"),children:"Create a Post"})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-3 sm:gap-4",children:L.map(s=>e.jsx("div",{className:"h-full",children:ae(s,"draft")},s.id))})}),e.jsx(re,{value:"scheduled",children:T.length===0?e.jsx(B,{className:"p-6 text-center",children:e.jsxs("div",{className:"py-8",children:[e.jsx(U,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No scheduled posts"}),e.jsx("p",{className:"text-neutral-medium text-sm mb-4",children:"Schedule posts to be published automatically"}),e.jsx(j,{onClick:()=>S("/dashboard/post"),children:"Create a Post"})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-3 sm:gap-4",children:T.map(s=>e.jsx("div",{className:"h-full",children:ae(s,"scheduled")},s.id))})}),e.jsx(re,{value:"published",children:_.length===0?e.jsx(B,{className:"p-6 text-center",children:e.jsxs("div",{className:"py-8",children:[e.jsx(Ie,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No published posts"}),e.jsx("p",{className:"text-neutral-medium text-sm mb-4",children:"Your published posts will appear here"}),e.jsx(j,{onClick:()=>S("/dashboard/post"),children:"Create a Post"})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-3 sm:gap-4",children:_.map(s=>e.jsx("div",{className:"h-full",children:ae(s,"published")},s.id))})})]}),ue&&p&&e.jsx(os,{open:ue,onOpenChange:s=>{s||J(!1)},children:e.jsxs(rs,{className:"sm:max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(ns,{children:[e.jsx(cs,{children:"Schedule LinkedIn Post"}),e.jsx(ds,{children:"Choose when you want this post to be published to LinkedIn"})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Date"}),e.jsx(ye,{type:"date",value:new Date(F).toISOString().split("T")[0],onChange:s=>{if(s.target.value)try{const l=s.target.value.split("-").map(Number),r=new Date(l[0],l[1]-1,l[2]),c=F.getHours(),n=F.getMinutes();if(r.setHours(c,n,0,0),!isNaN(r.getTime())){const o=new Date,d=new Date(o.getFullYear(),o.getMonth(),o.getDate());new Date(r.getFullYear(),r.getMonth(),r.getDate())>=d?(me(r),console.log("Set date to:",r.toISOString(),"from input:",s.target.value)):h.error("Please select today or a future date")}}catch(l){console.error("Error parsing date:",l),h.error("Invalid date format")}},min:new Date().toISOString().split("T")[0],className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Time"}),e.jsx(ye,{type:"time",value:K,onChange:s=>{ge(s.target.value);const[l,r]=s.target.value.split(":").map(Number),c=new Date(F);c.setHours(l,r,0,0);const n=new Date;if(c<=n&&c.getDate()===n.getDate()&&c.getMonth()===n.getMonth()&&c.getFullYear()===n.getFullYear()){const o=new Date;o.setMinutes(o.getMinutes()+15);const d=String(o.getHours()).padStart(2,"0"),t=String(o.getMinutes()).padStart(2,"0"),O=`${d}:${t}`;h.error(`Time must be in the future. Setting to ${O}`),ge(O),c.setHours(o.getHours(),o.getMinutes(),0,0)}me(c)},className:"w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Visibility"}),e.jsxs(hs,{value:pe,onValueChange:s=>fe(s),children:[e.jsx(us,{children:e.jsx(ms,{placeholder:"Select visibility"})}),e.jsxs(gs,{children:[e.jsx(ne,{value:"PUBLIC",children:"Public - Anyone on LinkedIn"}),e.jsx(ne,{value:"CONNECTIONS",children:"Connections only"}),e.jsx(ne,{value:"LOGGED_IN",children:"LinkedIn users only"})]})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Post Summary"}),e.jsxs("div",{className:"border rounded p-3 bg-white text-sm overflow-hidden",children:[e.jsx("div",{className:"max-h-24 overflow-y-auto mb-2",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words line-clamp-3",children:p.content||"No content yet"})}),p.postImage&&e.jsxs("div",{className:"flex items-center text-green-600 mt-1 text-xs",children:[e.jsx("span",{className:"font-medium mr-1",children:"Image:"}),e.jsx("span",{className:"truncate max-w-[200px] inline-block overflow-hidden",children:p.postImage.secure_url.split("/").pop()})]}),p.isPollActive&&p.pollOptions&&e.jsxs("p",{className:"text-blue-600 mt-1 text-xs",children:[e.jsx("span",{className:"font-medium",children:"Poll:"})," ",p.pollOptions.filter(s=>s==null?void 0:s.trim()).length," options"]}),e.jsxs("div",{className:"text-blue-600 mt-1 text-xs font-medium flex items-center",children:[e.jsx(U,{className:"h-3 w-3 mr-1 inline"}),e.jsxs("span",{className:"truncate",children:["Scheduled for: ",F.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})," at ",K]})]})]})]})]}),e.jsxs(ps,{className:"mt-2 pt-2 border-t",children:[e.jsx(j,{variant:"outline",onClick:()=>J(!1),children:"Cancel"}),e.jsx(j,{onClick:ze,disabled:xe,children:xe?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Scheduling..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Schedule Post"]})})]})]})})]})};export{Cs as default};
